version: '3.7'

networks:
  feelback:

services:
  feelback-web:
    container_name: feelback-web
    networks:
      - feelback
    ports:
      - '80:80'

  feelback-api:
    container_name: 'feelback-api'
    depends_on:
      - feelback-db
      - identity-db
    networks:
      - feelback
    ports:
      - ${FB_API_PORT}:${FB_API_PORT}

  pgadmin:
    image: dpage/pgadmin4
    container_name: 'feelback-pgadmin'
    depends_on:
      - feelback-db
      - identity-db
    ports:
      - ${PGA_PORT}:80
    networks:
      - feelback

  feelback-db:
    image: postgres:11-alpine
    container_name: 'feelback-db-feelback'
    networks:
      - feelback

  identity-db:
    image: postgres:11-alpine
    container_name: 'feelback-db-identity'
    networks:
      - feelback

  keycloak-db:
    image: postgres:11-alpine
    container_name: 'feelback-db-keycloak'
    networks:
      - feelback

  keycloak:
    image: jboss/keycloak:9.0.0
    container_name: 'feelback-keycloak'
    depends_on:
      - keycloak-db
    volumes:
      - .deployment/keycloak/feelback.realm-export.json:/opt/jboss/keycloak/imports/feelback.realm-export.json
    command:
      - '-b 0.0.0.0 -Dkeycloak.import=/opt/jboss/keycloak/imports/feelback.realm-export.json'
    ports:
      - ${KEYCLOAK_PORT:-8080}:8080
    networks:
      - feelback
